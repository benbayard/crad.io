var app=angular.module("crad",["ngRoute","ngTouch","ngResource","ngAnimate"]);app.config(["$routeProvider","$locationProvider",function(e,t){return e.when("/app/login",{templateUrl:"/assets/html/login.html",controller:"LoginController"}).when("/app/account",{templateUrl:"/assets/html/account.html",controller:"AccountController"}).when("/app/decks/:username/:deckname",{templateUrl:"/assets/html/deck.html",controller:"DeckController"}).when("/app/decks/:username/new",{templateUrl:"/assets/html/new-deck.html",controller:"NewDeckController"}).when("/app/decks/:username/:deckname/edit",{templateUrl:"/assets/html/new-deck.html",controller:"NewDeckController"}),t.html5Mode(!0)}]),app.directive("sitewideHeader",function(){return{restrict:"E",templateUrl:"/assets/html/sitewide-header.html",controller:"SitewideHeaderController"}}),app.directive("navAside",function(){return{restrict:"E",templateUrl:"/assets/html/nav-aside.html",controller:"NavAsideController"}}),app.controller("SitewideHeaderController",["$scope",function(e){}]),app.controller("NavAsideController",["$scope","$rootScope","$http","$location",function(e,t,o,n){localStorage.token?(o.defaults.headers.common.Authorization="Bearer "+localStorage.token,t.loggedIn=!0):t.loggedIn=!1,e.user=localStorage.user?JSON.parse(localStorage.user):{},console.log(e.user.decks),e.isActive=function(e){return e==n.path()},e.logOut=function(){delete localStorage.token,t.loggedIn=!1}}]),app.controller("LoginController",["$scope","$http","$rootScope",function(e,t,o){e.user={},e.getToken=function(){console.log("function is running dawg"),t.post("/login",{email:e.user.email,password:e.user.password}).success(function(e){o.user=e.user,localStorage.user=JSON.stringify(o.user),o.token=localStorage.token=e.token,o.loggedIn=!0}).error(function(e){})}}]),app.controller("DeckController",["$scope","$http","$routeParams","$rootScope","$location",function(e,t,o,n,a){t.defaults.headers.common.Authorization="Bearer "+localStorage.token,e.deck={},e.active="column",e.types={},e.editing=!1,e.startEditing=function(){a.path("/app/decks/"+o.username+"/"+o.deckname+"/edit")},e.isActive=function(t){return t==e.active},t.get("/decks/"+o.username+"/"+o.deckname).success(function(o){console.log("SUCCESSSS"),console.log(o),e.deck=o;for(cradName in e.deck.crads){var n=e.deck.crads[cradName];console.log(n),window.crads=e.deck.crads,localStorage[n.name]?(e.deck.crads[n.name].cradData=JSON.parse(localStorage[n.name]),void 0==e.types[n.cradData.types[0]]?e.types[n.cradData.types[0]]=new Array(e.deck.crads[n.name]):e.types[n.cradData.types[0]].push(e.deck.crads[n.name])):t.get("/crad/"+n.name).success(function(t){localStorage[t.name]=JSON.stringify(t),e.deck.crads[t.name].cradData=t,console.log(t),window.crads=e.deck.crads,void 0==e.types[n.cradData.types[0]]?e.types[n.cradData.types[0]]=new Array(e.deck.crads[n.name]):e.types[n.cradData.types[0]].push(e.deck.crads[n.name])})}}),t.post("/admin/"+o.username,{}).success(function(t){e.admin=!0})}]),app.controller("AccountController",["$scope","$http",function(e,t){}]),app.controller("NewDeckController",["$scope","$routeParams","$http",function(e,t,o){console.log(e),e.admin=!0,t.deckname&&o.post("/admin/"+t.username,{}).success(function(n){e.admin=!0,o.get("/decks/"+t.username+"/"+t.deckname).success(function(t){console.log("GOT THE FUCKING DECK ASSHOLE"),e.deck=t,void 0!==e.deck.crads&&(e.deck.crads=[]),e.deck.crads.push({quantity:0,name:""}),console.log(e.deck.crads)})}),e.suggestCard=function(e){e.name.length>0&&o.get("/crads/"+e.name).success(function(t){e.suggestions=t,console.log(t)})},e.setName=function(e,t,o){return e.name=t,delete e.suggestions,o.crads.push({quantity:null,name:""}),cradQuantities=document.querySelectorAll(".crad-quantity"),cradQuantities[cradQuantities.length-1].focus(),!0},e.isCradName=function(e,t){return e.name===t},e.gotoCradname=function(e,t){return 32===t.keyCode?(t.target.value=t.target.value.replace(/\s/g,""),setTimeout(function(){t.target.nextElementSibling.focus()},0),!1):void 0},e.handleCradChange=function(e,t){console.log("KEY HIT BABY!"),13===t.keyCode||8===t.keyCode&&(console.log(e.name),e.name&&0!==e.name.length&&0!==t.target.selectionEnd||setTimeout(function(){t.target.previousElementSibling.focus()},0))}}]);